i----------------------------------------	
igopher.black on tor, part 1	
iApril 27th, 2018	
i----------------------------------------	
i	
iI'm working on adding a tor hidden service to gopher.black so you	
ican enjoy all my steamy content anonymously, you sneaky vixen.	
iHonestly, the idea seemed a bit daunting but it's turned out to be	
ipretty straight forward. While I'm not at 100% yet, I thought	
iI learned enough to share while it's fresh in my mind.	
i	
iHere's the main steps going from a normal gopher server to	
ia torified one:	
i	
i  - Install tor	
i  - Configure tor to point to your server	
i  - Start tor	
i  - Find your hostname	
i	
i	
iStep 1: Install tor	
i	
iCheck out the install instructions on the tor website. In most	
icases it's as simple as:	
i	
i  sudo apt install tor	
i	
i	
iStep 2: Configure tor to point to your server	
i	
iEverything you need to configure in tor is located at	
i/etc/tor/torrc. Open that bad-boy up and jump down a bit until you	
ifind the section on Hidden Services. Mine is around line 72.	
iUncomment them and make it look like so:	
i	
i  HiddenServiceDir /var/lib/tor/hidden_service/	
i  HiddenServicePort 71 127.0.0.1:70	
i	
iThe first line is where your hidden service will store all its	
isecret shenanigans, like the private key it's going to	
iauto-generate for you. We'll look there in a minute to find the	
ihostname.	
i	
iThe second line describes Tor's mapping of fake port to real port.	
iSince we have our gopher hole running on port 70 that's what we	
ireference on the right. For now, we're going to tell Tor to	
ipretend port 71 is what we want to use publicly.	
i	
i	
iStep 3: Start tor	
i	
i  sudo service tor start # or whatever your machine uses	
i	
i	
iStep 4: Find your hostname	
i	
iIf you have your hidden service directory like mine above, then	
iyou just need to cat out the hostname hidden in that folder. It'll	
ibe set up to use root permissions, so sudo like so:	
i	
i  sudo cat /var/lib/tor/hidden_service/hostname	
i	
iIt'll spit out your ugly hostname. Mine is: fhsujakrrdvwq2gk.onion	
iI'll be changing it soon (see below).	
i	
i	
iOkay, now you're all set and ready to fire it up. To test you'll	
ineed a gopher client running on tor. I installed Overbite on my	
iTor Browser on my PC for easy testing, but you can also use torify	
ion lynx and a bunch of other things. Once you found a way to run	
ia tor browser that can see gopher, navigate to your gopher hole	
iusing the onion address and port 71.	
i	
i  For instance:	
i  gopher://fhsujakrrdvwq2gk.onion:71	
i	
iIt should work and you'll be moderately pleased. But now we have	
iproblems. 99 of them (not quite).	
i	
i1) Your onion address sux	
i2) All the links in your gopher hole on tor probably kick you back	
i   to your unencrypted, plaintext gopher hole	
i3) Port 71? What is this, NETRJS?	
i	
iHow can we deal with all these horrors? Let's take a look.	
i	
i	
iProblem 1: Onion addresses	
i	
iIt's possible to generate sexy onion addresses. You might be	
ifamiliar with protonmail's relatively readable one:	
i	
i  protonirockerxow.onion	
i	
iThat's almost words!	
i	
iSo how can you get that level of not-quite-suck? Why, brute force,	
iof course! Check out Eschalot [0].	
i	
h[0] Eschalot	URL:http://github.com/ReclaimYourPrivacy/eschalot
i	
iYou can use this and wait... and wait... and wait... and	
ieventually you'll have a cool onion address. There's some issues	
iwith it, as you can read on the README, but it's probably good	
ienough for gopher work.	
i	
i	
iProblem 2: Links	
i	
iI don't know what gopher server you're running. I'm on motsognir,	
iwhich I love and cherish with a little too much gusto. Chances are	
ithat your server is smart enough that if you have no gophermaps or	
iif you leave off the server & port info in your gophermaps they	
iare autogenerated based on your host name. That's awesome.	
iMotsognir does that too. Why aren't you using it again?	
i	
iRegardless, that will break your shit on tor cause we have	
ia totally different host name we want to use there.	
i	
iWhat's the solution? Well, unless someone has a better idea,	
iI think the best thing to do is install a second gopher server,	
iuse a different configuration with your tor address as the host	
iname, and change the port to something other than 70 (more on this	
inext). If you are on geomyidae, it's already set up so you can run	
imultiple instances of the server at the same time and override the	
ihost name and port via command line switches. I haven't figured	
iout how to do that with motsognir yet. I'll probably just install	
igophernicus next to motsognir and serve tor over that instead.	
iThey're fairly compatible in gophermap structures.	
i	
i	
iProblem 3: Port 71!@#$!@#$!$	
i	
iIf you install a second server and run it on another port, oh	
ilet's say... 1138, then you can update your torrc file and point	
itor at that new port. In fact, you can point tor at the new point	
iand let tor pretend it is serving it from 70. Like so:	
i	
i  HiddenServicePort 70 127.0.0.1:1138	
i	
iSexy.	
i	
iRestart tor and you should be good to go!	
i	
i	
iI'm still working through these 3 problems with my own solution,	
ibut once it's all done I'll be sure to share part 2 of my journey	
iand give you all the new tor address.	
